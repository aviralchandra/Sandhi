<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>GNU Radio 3.6.4.2 C++ API: Block Thread Affinity</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>


</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">GNU Radio 3.6.4.2 C++ API
   
   </div>
   
  </td>
  
  
  
   
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.6.1 -->
</div>
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
  initNavTree('page_affinity.html','');
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle">
<div class="title">Block Thread Affinity </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h2><a class="anchor" id="intro"></a>
Introduction</h2>
<p>In the thread-per-block scheduler, you can set the block's core affinity. Each block can be pinned to a group cores or be set back to use the standard kernel scheduler.</p>
<p>The implementation is done by adding new functions to the GRUEL library:</p>
<div class="fragment"><pre class="fragment">  <a class="code" href="namespacegruel.html#a6de6d44cd75f4cb0231445f6c68597c3" title="a system-dependent typedef for the underlying thread type.">gr_thread_t</a> <a class="code" href="namespacegruel.html#abf4f0ddbf64290819446901817615831" title="Get the current thread&#39;s ID as a gr_thread_t.">get_current_thread_id</a>();
  <span class="keywordtype">void</span> <a class="code" href="namespacegruel.html#abd2f6295c747739934dc022251be1807" title="Bind the current thread to a set of cores.">thread_bind_to_processor</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> n);
  <span class="keywordtype">void</span> <a class="code" href="namespacegruel.html#abd2f6295c747739934dc022251be1807" title="Bind the current thread to a set of cores.">thread_bind_to_processor</a>(<span class="keyword">const</span> std::vector&lt;unsigned int&gt; &amp;mask);
  <span class="keywordtype">void</span> <a class="code" href="namespacegruel.html#abd2f6295c747739934dc022251be1807" title="Bind the current thread to a set of cores.">thread_bind_to_processor</a>(<a class="code" href="namespacegruel.html#a6de6d44cd75f4cb0231445f6c68597c3" title="a system-dependent typedef for the underlying thread type.">gr_thread_t</a> <a class="code" href="namespacegruel.html#acf8a10d5cbbe169118cacbc8e8faabf8">thread</a>, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> n);
  <span class="keywordtype">void</span> <a class="code" href="namespacegruel.html#abd2f6295c747739934dc022251be1807" title="Bind the current thread to a set of cores.">thread_bind_to_processor</a>(<a class="code" href="namespacegruel.html#a6de6d44cd75f4cb0231445f6c68597c3" title="a system-dependent typedef for the underlying thread type.">gr_thread_t</a> <a class="code" href="namespacegruel.html#acf8a10d5cbbe169118cacbc8e8faabf8">thread</a>, <span class="keyword">const</span> std::vector&lt;unsigned int&gt; &amp;mask);
  <span class="keywordtype">void</span> <a class="code" href="namespacegruel.html#afd5e570015c1d84a0e8fec66d181325e" title="Remove any thread-processor affinity for the current thread.">thread_unbind</a>();
  <span class="keywordtype">void</span> <a class="code" href="namespacegruel.html#afd5e570015c1d84a0e8fec66d181325e" title="Remove any thread-processor affinity for the current thread.">thread_unbind</a>(<a class="code" href="namespacegruel.html#a6de6d44cd75f4cb0231445f6c68597c3" title="a system-dependent typedef for the underlying thread type.">gr_thread_t</a> <a class="code" href="namespacegruel.html#acf8a10d5cbbe169118cacbc8e8faabf8">thread</a>);
</pre></div><p>The ability to set a thread's affinity to a core or groups of cores is not implemented in the Boost thread library, and so we have made our own portability library. In particular, the <a class="el" href="namespacegruel.html#a6de6d44cd75f4cb0231445f6c68597c3" title="a system-dependent typedef for the underlying thread type.">gruel::gr_thread_t</a> type is defined as the thread type for the given system. The other functions are designed to be portable as well by calling the specific implementation for the thread affinity for a particular platform.</p>
<p>There are functions to set a thread to a group of cores. If the thread is not given, the current thread is used. If a single number is passed, only that core is set (this is equivalent to a core mask with just a single value).</p>
<p>Similarly, there are functions to unset the affinity. This practically implements the setting of the thread's affinity to all possible cores. Again, the function that does not take a thread argument unsets the affinity for the current thread.</p>
<h2><a class="anchor" id="affinity_api"></a>
GNU Radio Block API</h2>
<p>Each block has two new data members:</p>
<ul>
<li>threaded: a boolean value that is true if the block is attached to a thread.</li>
<li>thread: a <a class="el" href="namespacegruel.html#a6de6d44cd75f4cb0231445f6c68597c3" title="a system-dependent typedef for the underlying thread type.">gruel::gr_thread_t</a> handle to the block's thread.</li>
</ul>
<p>A block can set and unset it's affinity at any time using the following member functions:</p>
<ul>
<li>gr_block::set_processor_affinity(const std::vector&lt;unsigned int&gt; &amp;mask)</li>
<li><a class="el" href="structgr__block.html#ad970b908c19d27123e6bafcd614296c6" title="Remove processor affinity to a specific core.">gr_block::unset_processor_affinity()</a></li>
</ul>
<p>Where <code>mask</code> is a vector of core numbers to set the thread's affinity to.</p>
<p>The current core affinity can be retrieved using the member function:</p>
<ul>
<li><a class="el" href="structgr__block.html#a3aa2883db9211f3163911c10868f3ae0" title="Get the current processor affinity.">gr_block::processor_affinity()</a></li>
</ul>
<p>When set before the flowgraph is started, the scheduler will set the thread's affinity when it is started. When already running, the block's affinity will be immediately set. </p>
</div></div><!-- contents -->
</div>
  <div id="nav-path" class="navpath">
    <ul>

    <li class="footer">Generated on Mon Oct 14 2013 11:58:12 for GNU Radio 3.6.4.2 C++ API by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.6.1 </li>
   </ul>
 </div>


</body>
</html>
